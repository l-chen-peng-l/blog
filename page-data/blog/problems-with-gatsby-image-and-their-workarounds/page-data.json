{"componentChunkName":"component---src-templates-article-page-js","path":"/blog/problems-with-gatsby-image-and-their-workarounds/","webpackCompilationHash":"43e76ece0bcbc56bcb42","result":{"data":{"markdownRemark":{"id":"32640979-6552-5540-a9f5-545bdc703a74","html":"<p><a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">Gatsby Image</a> is a very powerful package with drool worthy features. It makes it very easy to implement, Medium like progressive image loading. It can do a bunch of other stuff but that's the fancy stuff. But I decided to not use it for this website, mostly because it doesn't play well with <a href=\"https://www.netlifycms.org\">Netlify CMS</a>. And, I was quite happy with the site's performance as it doesn't have many images.</p>\n<p>The article list is all words no thumbnails and since all the images are within article, it's works out fine. This all changed when I decided to ditch <a href=\"https://bulma.io\">Bulma</a> for <a href=\"https://tachyons.io\">Tachyons</a>.</p>\n<blockquote>\n<p>\"With New Framework Comes New Design\"</p>\n<p>- Anonymous</p>\n</blockquote>\n<p>In the new design I was working the article list had a small thumbnails along with the title and excerpt. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1646px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6828501e87d56286c9c5aa44de4a42ba/54f11/screenshot-2018-12-19-at-11.19.21-pm.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.077764277035236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQUlEQVQY04WQv0sCYRjH729oCloaRJJAyqUfiFghFNHZUouEtLbUUkNDg9EYRFFoURIiWdiZ5UVbS7RXYzgfp9553p3nIOc3n1deoZa+8OF533tfnvfznOA4DnRdR6PRgGEYME2T7fmasG2bfaO8v70il7lA4TaDx4c7vMgS5Kd73GTTKJe/IbRaLXa5UqmgWq2iVqv1a71eZ9C5oiis4eZGHGO+QcxOjSIS9CM47kF4wgfv8ACkfA5Cu92GZVkMsuSVmxFkS5NQEoldLIsziMeiWI+JWFkKY211EZFQAM9ysWdIRgSZcDRNY5VMaU0PUHa2txDwe7AwN9llGtH5EMQuI94hSIV8z7DZbIIau64Lnk6n8wt+VioVcXJ8iOurFNKXSZynzpA8PcLB/h6+Pj8g0CiqqvYt6Z/x8f6GGv+XH2gClHY+3RawAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot 2018 12 19 at 11 19 21 pm\"\n        title=\"screenshot 2018 12 19 at 11 19 21 pm\"\n        src=\"/static/6828501e87d56286c9c5aa44de4a42ba/54f11/screenshot-2018-12-19-at-11.19.21-pm.png\"\n        srcset=\"/static/6828501e87d56286c9c5aa44de4a42ba/c5a17/screenshot-2018-12-19-at-11.19.21-pm.png 512w,\n/static/6828501e87d56286c9c5aa44de4a42ba/3b243/screenshot-2018-12-19-at-11.19.21-pm.png 1024w,\n/static/6828501e87d56286c9c5aa44de4a42ba/54f11/screenshot-2018-12-19-at-11.19.21-pm.png 1646w\"\n        sizes=\"(max-width: 1646px) 100vw, 1646px\"\n      />\n  </a>\n    </span></p>\n<p>Without the optimisation magic of <a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">Gatsby Image</a> each page size would be touching 5MB. Begrudgingly, I decided to use <a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">Gatsby Image</a>. I did what anyone would do, installed the package and peer dependencies. And as instructed added the relevant config. That's when problem began! Everything started breaking. And I'm ashamed that it took me lot more time than I'm willing to admit, to solve them. Well everyone has bad days.</p>\n<h1>Things to be careful about while configuring Gatsby Image</h1>\n<p>First, you need '<strong>gatsby-remark-relative-images</strong>' to convert image src(s) in markdown to be relative to their node's parent directory. So that '<strong>gatsby-remark-images</strong>' can match images outside the node folder. This is especially important if you are working with <a href=\"https://www.netlifycms.org\">Netlify CMS</a>. Also, don't forget to add fmImagesToRelative to <em>gatsby-node.js</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>fmImagesToRelative<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gatsby-remark-relative-images'</span><span class=\"token punctuation\">)</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateNode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>node<span class=\"token punctuation\">,</span> actions<span class=\"token punctuation\">,</span> getNode<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>createNodeField<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n  <span class=\"token function\">fmImagesToRelative</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token template-string\"><span class=\"token string\">`MarkdownRemark`</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token function\">createFilePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>node<span class=\"token punctuation\">,</span> getNode<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`slug`</span></span><span class=\"token punctuation\">,</span>\n      node<span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Second, The '<strong>gatsby-source-filesystem</strong>' media folder must be included before the other plugins, especially <a href=\"https://www.netlifycms.org\">Netlfiy CMS</a>. That's something that has been mentinoned in <strong>gatsby-transformer-remark</strong>'s README.md. Not only that, it'll be best if you include '<strong>gatsby-transformer-sharp</strong>' '<strong>gatsby-plugin-sharp'</strong> and '<strong>gatsby-transformer-remark</strong>' before any other plugin in <em>gatsby-config.js</em>. Not doing this will definitely lead to '<strong>Field \"image\" must not have a selection since type \"String\" has no subfields</strong>' error.</p>\n<p>Third, once you are done configuring you cannot just query an image without parameters. I suggest <strong>publicURL</strong>.</p>\n<p>Fourth, GIFs and SVGs are not processed by <a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">Gatsby Image</a>. So always include <strong>publicURL</strong> in the parameters as an alternate.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> imageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token string\">`\n       image {\n            childImageSharp {\n                fluid(maxWidth: 1075, quality: 72) {\n                    ...GatsbyImageSharpFluid\n                }\n            }\n            publicURL\n        }`</span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">        <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span>image <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>image<span class=\"token punctuation\">.</span>childImageSharp\n          <span class=\"token operator\">?</span> <span class=\"token operator\">&lt;</span>Img fluid<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>image<span class=\"token punctuation\">.</span>childImageSharp<span class=\"token punctuation\">.</span>fluid<span class=\"token punctuation\">}</span>\n                 alt<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>image<span class=\"token punctuation\">.</span>publicURL<span class=\"token punctuation\">}</span>\n                 alt<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span> \n           <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Finally, sometimes the build can fail just because <strong>node_modules/</strong> needs to be rebuilt. So, if you see nothing else working try removing <strong>node_modules/</strong> and reinstalling packages.</p>\n<h1>Gatsby Image and Gatsby Paginate don't go well together</h1>\n<p>While implementing Article List I ran into an error that disturbed me for hours. Let me preface by explaining how <a href=\"ttps://www.gatsbyjs.org/packages/gatsby-paginate\">Gatsby Paginate</a> works. We plugin Gatsby Paginate's <code>createPaginatedPages</code> function in <em>gatsby-node.js</em>. It takes the <code>createPages</code> method and takes results of the query to create paginated list of posts.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">return</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`\n    {\n      allMarkdownRemark(sort: { order: DESC, fields: [frontmatter___date] }) {\n        edges {\n          node {\n            excerpt(pruneLength: 250)\n            id\n            fields {\n              slug\n            }\n            frontmatter {\n              title\n              tags\n              date(formatString: \"MMMM DD, YYYY\")\n              templateKey\n            }\n          }\n        }\n      }\n    }\n  `</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>So, if I had to display a thumbnail on my article list I just add that query. Simple enough right? Wrong! You add image to the query, and you run into the first problem, it needs to have parameters. That's okay, you need to apply <code>...GatsbyImageSharpFluid</code> anyways, but wait! This throws an error, one that drove me crazy and made me write this article.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">return</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`\n    {\n      allMarkdownRemark(sort: { order: DESC, fields: [frontmatter___date] }) {\n        edges {\n          node {\n            excerpt(pruneLength: 250)\n            id\n            fields {\n              slug\n            }\n            frontmatter {\n              image\n              title\n              tags\n              date(formatString: \"MMMM DD, YYYY\")\n              templateKey\n            }\n          }\n        }\n      }\n    }\n  `</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Error: unknown fragment <span class=\"token punctuation\">..</span>.GatsbyImageSharpFluid</code></pre></div>\n<p>This is an annoying problem because the reason it states is very confusing! Clearly, <strong>GatsbyImageSharpFluid</strong> is a fragment and I know that for sure. After searching for hours I find out an interesting thing.</p>\n<p>The query in <em>gatsby-node.js</em> is only the path and stuff you put in context, which you can use in your page/template to retrieve the data you need. What this means is it's only creating pages, the query there isn't really supposed to be passing data down besides a kind of reference which you can use in the page to make a query for the specific kind of data that page needs. Hence, it doesn't recognise <strong>GatsbyImageSharpFluid</strong> as a valid fragment.</p>\n<p>Which brings us to workaround. After looking online I found that I'm not the only one to run into this Catch 22. Various people found various work arounds, with varying results. After failing to get any of them working for me, it struck me. A workaround that'll work for everyone, not ideal but universal. All you gotta do is pass the required fields of fluid to it manually. And to add the base64 placeholder image, top it off with <strong>base64</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">return</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`\n    {\n      allMarkdownRemark(sort: { order: DESC, fields: [frontmatter___date] }) {\n        edges {\n          node {\n            excerpt(pruneLength: 250)\n            id\n            fields {\n              slug\n            }\n            frontmatter {\n              image {\n                childImageSharp{\n                  fluid (maxWidth:500, quality:50){\n                    src\n                    srcSet\n                    aspectRatio\n                    sizes\n                    base64\n                  }\n                }\n                publicURL\n              }\n              title\n              tags\n              date(formatString: \"MMMM DD, YYYY\")\n              templateKey\n            }\n          }\n        }\n      }\n    }\n  `</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ooooorrrrr, you could simply use one of the other plugins for pagination.</p>\n<p>Neither <a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">Gatsby Image</a> nor <a href=\"ttps://www.gatsbyjs.org/packages/gatsby-paginate\">Gatsby Paginate</a> are ideal packages. But the utility they provide is without question, very helpful. As the Gatsby community grows, we'll have perfect solutions. But till then I just hope we keep sharing the problems we run into and how we overcome them.</p>","fields":{"slug":"/blog/problems-with-gatsby-image-and-their-workarounds/"},"frontmatter":{"date":"December 19, 2018","title":"Problems with Gatsby Image and their workarounds","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHj0QBqYI//xAAaEAACAgMAAAAAAAAAAAAAAAACEQABAxAS/9oACAEBAAEFAhBwRxsxvp6dz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAQADAAAAAAAAAAAAAAAAAAAgMdH/2gAIAQEABj8CbC3/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhMUFh/9oACAEBAAE/ISN3U3DfnEBg45TBBQwUl/U//9oADAMBAAIAAwAAABB7P//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EBJ//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qh//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExQWFxgZH/2gAIAQEAAT8QaoMazzA1ROg+sRoMeIT1LaA6jljN1Pihqf/Z","aspectRatio":1.5026943802925328,"src":"/blog/static/559f0557145caf0826c1b8ffc79f694d/1511b/gatsby-image-workarounds.jpg","srcSet":"/blog/static/559f0557145caf0826c1b8ffc79f694d/79e64/gatsby-image-workarounds.jpg 269w,\n/blog/static/559f0557145caf0826c1b8ffc79f694d/b1729/gatsby-image-workarounds.jpg 538w,\n/blog/static/559f0557145caf0826c1b8ffc79f694d/1511b/gatsby-image-workarounds.jpg 1075w,\n/blog/static/559f0557145caf0826c1b8ffc79f694d/57d19/gatsby-image-workarounds.jpg 1613w,\n/blog/static/559f0557145caf0826c1b8ffc79f694d/42ccd/gatsby-image-workarounds.jpg 1952w","sizes":"(max-width: 1075px) 100vw, 1075px"}},"publicURL":"/blog/static/gatsby-image-workarounds-559f0557145caf0826c1b8ffc79f694d.jpeg"},"meta_title":"Problems with Gatsby Image and their workarounds","meta_description":"Gatsby Image is a very powerful package with drool worthy features. It makes it very easy to implement, Medium like progressive image loading among other things. But it has its fair share of problems. Here are some of them along with workarounds.","tags":["GatsbyJS"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"32640979-6552-5540-a9f5-545bdc703a74"}}}