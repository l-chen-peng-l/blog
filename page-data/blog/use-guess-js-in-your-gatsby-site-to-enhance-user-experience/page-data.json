{"componentChunkName":"component---src-templates-article-page-js","path":"/blog/use-guess-js-in-your-gatsby-site-to-enhance-user-experience/","webpackCompilationHash":"05993ececeb8f04d6dab","result":{"data":{"markdownRemark":{"id":"d2faf7d0-7400-5d7d-94be-e380035e9509","html":"<p>Ever since I learnt about <strong>HTTP/2</strong>'s <em>preload</em> and <em>prefetch</em>, I had a very small idea  - what if there was a way to use Google Analytics data to predict and prefetch the relevant resources accordingly! That idea came to life with <a href=\"https://github.com/guess-js/guess\">Guess JS</a>, although it had nothing to do with me. What's better is that I learnt about it when a <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-guess-js\">Gatsby JS plugin</a> was released for it. The perfect platform for such a library. But since it is very new and experimental and still evolving there's a lack of proper documentation. While implementing it on this blog I found out that it's not so straight forward in CI/CD environments. Here's how you can do it.</p>\n<h2>Get Required Credentials for <em>Google Analytics</em> API</h2>\n<p>To get your <strong>Google Analytics API</strong> go to <a href=\"https://console.developers.google.com/\">Google API Console</a> go to <em>Credentials</em> section in the sidebar.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 2048px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee37aa3ef6c80712b22df3a14ba52e97/a1bed/screenshot-2019-04-03-at-11.59.00-pm.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.3719806763285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQY032RSW7DMAxFff+bdNsDdNcbdF2giyKx5UQTNQ8/lIwY7aIV8CCIEj/5qcWQg7zdoaSEVAr7vkMIgcvlCu89WmuIMcIYM8/OuT9JKWHZtg2CWdd1io0LoyW26zdicOi9o5RyknP+lyUED6UkV6eZ0FvBTRd8rQni7qAN8cOEEMLscBQ4Vj8ZsSeLNB5XoSFNgHWjSsHHJ+HlbcXrO1sXhmOR7eRpKc9OK+/t5JegpoxNJuw6sWAC+cwzY3GjYa2Z8xvdjX2Q+C6EBB87fAJcbD+6BpbCdmrJk2Gt1gIiguRPstbOT3muxnmKKiqHiMwc1WEbhyjzAFkL0blNx1fiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google-api-console-credentials-guessjs\"\n        title=\"google-api-console-credentials\"\n        src=\"/static/ee37aa3ef6c80712b22df3a14ba52e97/12f40/screenshot-2019-04-03-at-11.59.00-pm.png\"\n        srcset=\"/static/ee37aa3ef6c80712b22df3a14ba52e97/c5a17/screenshot-2019-04-03-at-11.59.00-pm.png 512w,\n/static/ee37aa3ef6c80712b22df3a14ba52e97/3b243/screenshot-2019-04-03-at-11.59.00-pm.png 1024w,\n/static/ee37aa3ef6c80712b22df3a14ba52e97/12f40/screenshot-2019-04-03-at-11.59.00-pm.png 2048w,\n/static/ee37aa3ef6c80712b22df3a14ba52e97/a1bed/screenshot-2019-04-03-at-11.59.00-pm.png 2070w\"\n        sizes=\"(max-width: 2048px) 100vw, 2048px\"\n      />\n  </a>\n    </span></p>\n<p>Click on <em>Create credentials</em> and select <em>Service account key</em> from the dropdown.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1636px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a5bf733f1702ece3792076455a8c2ba/0bf9b/screenshot-2019-04-04-at-12.03.05-am.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.61858190709046%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABOUlEQVQoz12Sy07DMBBF/f9fg5CQEOxg0wVbqNSmLKo8KWljx07iVy4zToIEkY7Gjj3Xd8YWeZ6jKApwLMsSfd/DGEPjAlmW4bu9wjmPaZoS1trENv+PUEqhpSQWGoYxbQ4hwDtHTAA8EeG9R4xLdLTGe/ib5/kPQvcKsrtSMgnRZo6c8PzW4WF3w+OuxsfpAqMlObDQWqfD2c0mQrKsnBBNa5A3GrfeQuoFM3o87XLcv+S4e73g/bOjg8j96ixVsDq11mG0EZNbEK20qNoJV2WhjENHwpYWBk1t6C5U7QBvB3JmkruNpUX0z4xQQ4Qe5xSF9xYxUL+8W8uleQyomy8csxPKqqZknS6K2QR5zOWGwL31a56H2G5twf1eyvl8xn6/x+FwSOPtJXBk+EVUVZWEpZSo6yYd9AOY7BnGryi2UgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google-api-console-credentials-guessjs-2\"\n        title=\"google-api-console-credentials-2\"\n        src=\"/static/9a5bf733f1702ece3792076455a8c2ba/0bf9b/screenshot-2019-04-04-at-12.03.05-am.png\"\n        srcset=\"/static/9a5bf733f1702ece3792076455a8c2ba/c5a17/screenshot-2019-04-04-at-12.03.05-am.png 512w,\n/static/9a5bf733f1702ece3792076455a8c2ba/3b243/screenshot-2019-04-04-at-12.03.05-am.png 1024w,\n/static/9a5bf733f1702ece3792076455a8c2ba/0bf9b/screenshot-2019-04-04-at-12.03.05-am.png 1636w\"\n        sizes=\"(max-width: 1636px) 100vw, 1636px\"\n      />\n  </a>\n    </span></p>\n<p>In the new page create a new Service Account. Give desired names, and for the role select Service Accounts > Service Account User.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1778px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2835518c77878ee0297314ee8e73911/b054d/screenshot-2019-04-04-at-9.37.59-pm.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.45669291338583%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVQoz21S2Y7EIAzj/79un7c705eW3qX0vjM4EojuEMmChsQ1DmIcR6rrmtZ1JQS+h2GgeZ45jxVxnicDcd83IxSiaRra950BUks4TRNlWUZd1znCbdsehD6xXcVv9DJKKlpNMRos+XEclCQJQ2vtzkLhqxW6a4wKRcuyPAACpZS7tlWIH1lc1/Wt8OdvolZpQzJzgfUKBWVZOg9xBhviOGZIKbnG95UJZbPTth8mcX1dJU1TiqKI+r53hHmec74oCrYA+Qfhfy98o9EsZcYeIge1GBR8xRmG5xMCIjQtu0fz+/1i79AIgrZtqaoq3tt8UGGIEN7WrXbPxp9ySATwAWkRvnf52Q/XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google-api-console-credentials-guessjs-3\"\n        title=\"google-api-console-credentials-3\"\n        src=\"/static/d2835518c77878ee0297314ee8e73911/b054d/screenshot-2019-04-04-at-9.37.59-pm.png\"\n        srcset=\"/static/d2835518c77878ee0297314ee8e73911/c5a17/screenshot-2019-04-04-at-9.37.59-pm.png 512w,\n/static/d2835518c77878ee0297314ee8e73911/3b243/screenshot-2019-04-04-at-9.37.59-pm.png 1024w,\n/static/d2835518c77878ee0297314ee8e73911/b054d/screenshot-2019-04-04-at-9.37.59-pm.png 1778w\"\n        sizes=\"(max-width: 1778px) 100vw, 1778px\"\n      />\n  </a>\n    </span></p>\n<p>After clicking on Create, a JSON file would begin downloading.</p>\n<h2>Add <em>gatsby-plugin-guess-js</em> to <em>gatsby-config.js</em> dynamically</h2>\n<p>From the above downloaded JSON file we'll need two credentials <code>client_email</code> and <code>private_key</code> for the plugin. Also, we'll need Google Analytics View ID. GA View ID can be found in View Section of Google Analytics Admin Page.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 2048px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa93d3950b31cbd1d6fdef9b37cb5902/d9c9b/screenshot-2019-04-04-at-9.23.01-pm.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.24483043837883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWklEQVQoz3WSwXLDIAxE+f8/67GnXHrpTNtTJrYxCAw4W60IGcedMtEklrKrJ2Hn/YoQExYfEEJEkA05F6S8QVK24G/mg+RnbkTUXEyq2ajb4G7TjFYrakm4fGW8fVQscgdwx37v3z4WzRdcvps+3vXDPFBbw/tnxeVnt2em3aKELIsI5mXFGjP2vYsYTUUkn31UitqF+241aqbrDaL1olClFDi/BnNmkVEU/UhBw5SShtgknaTXctZxV4+stVqb/ddN02Kj0V1UWFU06EZQSNNjjofNRZKNPnJuXrwRUkTCeqJgV++9jh1emtkO9dmmUpiRd3kraLqT1qqJzxTMxRifwtGMQUOCHCEcX4nW+i0dyc6G6bQOG5lr0kasj/2qYXkannfHsyv9mcLiMTIbidCw07uck43836FhF8kfwk0vZZ7nlwtzX9dkojPdCCO02xQzONbKg/DY6Bdtw2AB9/yMGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google-analytics-view-id-guessjs\"\n        title=\"google-analytics-view-id\"\n        src=\"/static/fa93d3950b31cbd1d6fdef9b37cb5902/12f40/screenshot-2019-04-04-at-9.23.01-pm.png\"\n        srcset=\"/static/fa93d3950b31cbd1d6fdef9b37cb5902/c5a17/screenshot-2019-04-04-at-9.23.01-pm.png 512w,\n/static/fa93d3950b31cbd1d6fdef9b37cb5902/3b243/screenshot-2019-04-04-at-9.23.01-pm.png 1024w,\n/static/fa93d3950b31cbd1d6fdef9b37cb5902/12f40/screenshot-2019-04-04-at-9.23.01-pm.png 2048w,\n/static/fa93d3950b31cbd1d6fdef9b37cb5902/d9c9b/screenshot-2019-04-04-at-9.23.01-pm.png 2418w\"\n        sizes=\"(max-width: 2048px) 100vw, 2048px\"\n      />\n  </a>\n    </span></p>\n<p>Ideally you store these in an environment variable, for this tutorial's context they'll be <strong>GA<em>VIEW</em>ID</strong>, <strong>CLIENT_EMAIL</strong> &#x26; <strong>PRIVATE_KEY</strong>.</p>\n<p>We begin by installing the plugin:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> gatsby-plugin-guess-js</code></pre></div>\n<p>Next, we add it to our <code>gatsby-config.js</code> file, but wait there's a catch. This is what we call a dynamic plugin, to add this we'll need to first create an array and push the plugin to that.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> dynamicPlugins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\">// pick data from 3 months ago</span>\n<span class=\"token keyword\">const</span> startDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nstartDate<span class=\"token punctuation\">.</span><span class=\"token function\">setMonth</span><span class=\"token punctuation\">(</span>startDate<span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CLIENT_EMAIL</span> <span class=\"token operator\">&amp;&amp;</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PRIVATE_KEY</span> <span class=\"token operator\">&amp;&amp;</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">GA_VIEW_ID</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dynamicPlugins<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-plugin-guess-js`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        GAViewID<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">GA_VIEW_ID</span><span class=\"token punctuation\">,</span>\n        jwt<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          client_email<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CLIENT_EMAIL</span><span class=\"token punctuation\">,</span>\n          private_key<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PRIVATE_KEY</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        period<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          startDate<span class=\"token punctuation\">,</span>\n          endDate<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we take our <code>dynamicPlugins</code> array and concat it with our main plugin config array.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  siteMetadata<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n   <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>dynamicPlugins<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And that's it! Now test it out to see if everything works fine.</p>\n<p><strong>TIP:</strong> If you are adding it to an existing project and adding this plugin breaks your build, try removing <code>.cache</code>, <code>public</code> and <code>node_modules</code>, reinstalling the npm packages and then re building.</p>","fields":{"slug":"/blog/use-guess-js-in-your-gatsby-site-to-enhance-user-experience/"},"frontmatter":{"date":"April 04, 2019","title":"Use Guess JS in your Gatsby site to enhance User Experience","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABh2upUIxn/8QAGRABAAIDAAAAAAAAAAAAAAAAAQACAxEi/9oACAEBAAEFAqmOX0nMxETi5p//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAaEAACAgMAAAAAAAAAAAAAAAAAERAxAkJR/9oACAEBAAY/AthLKosXY//EAB0QAAICAQUAAAAAAAAAAAAAAAABESFxMUFRYZH/2gAIAQEAAT8hoU98IRRFKKlmXo7XI3TIj10f/9oADAMBAAIAAwAAABDkL//EABcRAQADAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QCzY//8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/EFxn/8QAHBAAAgMBAAMAAAAAAAAAAAAAAREAITFRQXGB/9oACAEBAAE/EESPEHidbAbiAjG75FhwqpcGJEk6fDEg1kPRCDYNicn/2Q==","aspectRatio":1.5,"src":"/blog/static/847193a287954d98eb359425ce362612/1511b/gatsby-guess-js.jpg","srcSet":"/blog/static/847193a287954d98eb359425ce362612/79e64/gatsby-guess-js.jpg 269w,\n/blog/static/847193a287954d98eb359425ce362612/b1729/gatsby-guess-js.jpg 538w,\n/blog/static/847193a287954d98eb359425ce362612/1511b/gatsby-guess-js.jpg 1075w,\n/blog/static/847193a287954d98eb359425ce362612/57d19/gatsby-guess-js.jpg 1613w,\n/blog/static/847193a287954d98eb359425ce362612/ede7d/gatsby-guess-js.jpg 2150w,\n/blog/static/847193a287954d98eb359425ce362612/17d28/gatsby-guess-js.jpg 6000w","sizes":"(max-width: 1075px) 100vw, 1075px"}},"publicURL":"/blog/static/gatsby-guess-js-847193a287954d98eb359425ce362612.jpg"},"meta_title":"Leverage Guess JS in your Gatsby website to improve user experience","meta_description":"Learn how to use guess js to enhance user experience of your Gatsby site. Guess JS uses Google Analytics data to determine which page a user is mostly likely to visit next from a given page and prefetches them, making UX super smooth.","tags":["GatsbyJS","GuessJS","MachineLearning","UX"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"d2faf7d0-7400-5d7d-94be-e380035e9509"}}}