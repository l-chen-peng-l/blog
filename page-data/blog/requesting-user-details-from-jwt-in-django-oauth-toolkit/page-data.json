{"componentChunkName":"component---src-templates-article-page-js","path":"/blog/requesting-user-details-from-jwt-in-django-oauth-toolkit/","webpackCompilationHash":"ba49793154015d67d217","result":{"data":{"markdownRemark":{"id":"7f8850e1-eb88-50e4-a31a-f1c1dbf7fb9d","html":"<p>We always require an API to fetch the details of the current user. This API unfortunately isn't provided by default in Django OAuth Toolkit. But worry not, it's fairly easy to write this API, and that is what we'll do. But before we begin, let's clarify some assumptions:</p>\n<ul>\n<li>This tutorial is written with Django 2.0 specific commands in mind (eg. Path)</li>\n<li>This is for someone who has Django OAuth Toolkit already up and running in the project.</li>\n<li>This tutorial doesn't mention imports and will have to be done by developer accordingly.</li>\n</ul>\n<p>Now that that's clear, let's begin.</p>\n<h2>Setting up the Authentication Backend and Middlewares</h2>\n<p>Before we begin writing <code>API View</code>, first make sure to add the following in the <code>settings.py</code> of the project. First we add <code>AUTHENTICATION_BACKENDS</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">AUTHENTICATION_BACKENDS <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'oauth2_provider.backends.OAuth2Backend'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># Not required for DOT, but required for Admin</span>\n    <span class=\"token string\">'django.contrib.auth.backends.ModelBackend'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then we add relevant <code>MIDDLEWARE</code> for the OAuth Toolkit:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">MIDDLEWARE <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'...'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\"># If you use SessionAuthenticationMiddleware, be sure it appears before OAuth2TokenMiddleware.</span>\n    <span class=\"token comment\"># SessionAuthenticationMiddleware is NOT required for using DOT.</span>\n    <span class=\"token string\">'django.contrib.auth.middleware.SessionAuthenticationMiddleware'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'oauth2_provider.middleware.OAuth2TokenMiddleware'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'...'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>These steps are essentials for getting <code>request.user</code> function, which will be required while writing the <code>API View</code>.</p>\n<h2>Writing the API</h2>\n<p>In the <code>views.py</code> we'll write a <code>generic Retrieve API View</code> which when called along with the authorization token will return the User details. For that, we'll first write a <code>serializer</code> that will define our JSON response.</p>\n<h3>Serializer for the User</h3>\n<p>For our JSON response let's take id, first name, last name, email and username. In the <code>serializers.py</code> file write the following Model Serializer class</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDetailSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> User\n        fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'first_name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'last_name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'username'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>The Retrieve API View</h3>\n<p>In the <code>views.py</code> file we'll write the UserDetail View:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDetailView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>RetrieveAPIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Use this endpoint to retrieve user.\n    \"\"\"</span>\n    <span class=\"token comment\"># Set the AUTH_USER_MODEL in settings.py file to make it work with custom user models as well.</span>\n    model <span class=\"token operator\">=</span> settings<span class=\"token punctuation\">.</span>AUTH_USER_MODEL\n    serializer_class <span class=\"token operator\">=</span> UserDetailSerializer\n    <span class=\"token comment\"># Set the permission class if not already set by default</span>\n    permission_classes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>permissions<span class=\"token punctuation\">.</span>IsAuthenticated<span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_object</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>user</code></pre></div>\n<h3>The API Path</h3>\n<p>Now that the tough part is over we'll write the URL Path for the API. In your <code>urls.py</code> add the following url pattern.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">urlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'...'</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'api/me/'</span><span class=\"token punctuation\">,</span> UserDetailView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">'me'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>That's all for the coding part, now when you call the <code>http://localhost:8000/api/me/?format=json</code> with Authorization Header, you'll get the ID, First Name, Last Name, Email and Username of the user associated with the JSON Web Token.</p>","fields":{"slug":"/blog/requesting-user-details-from-jwt-in-django-oauth-toolkit/"},"frontmatter":{"date":"April 16, 2018","title":"Requesting User details from JWT in Django OAuth Toolkit","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABvOyvJIz/AP/EABoQAAIDAQEAAAAAAAAAAAAAAAECAxEhABL/2gAIAQEAAQUCD9lrREClhKMjY+P/xAAWEQEBAQAAAAAAAAAAAAAAAAARAAH/2gAIAQMBAT8BwZv/xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/AYNaf//EAB4QAAIBAwUAAAAAAAAAAAAAAAABMQIQEhEhImFx/9oACAEBAAY/Anzq28JfZqnUZ5STb//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExUXH/2gAIAQEAAT8hax2VjDRubqsgzMvpLsdjlRR1sfJSanxqf//aAAwDAQACAAMAAAAQk+//xAAXEQEBAQEAAAAAAAAAAAAAAAABABFR/9oACAEDAQE/EFhxgZf/xAAWEQEBAQAAAAAAAAAAAAAAAAABEQD/2gAIAQIBAT8QVZpLf//EAB4QAAIDAAEFAAAAAAAAAAAAAAERACExQVFhcZGh/9oACAEBAAE/ENaRch8imKVhr9S9mG934hLSIpOQtkFgpc7pHA3oJ//Z","aspectRatio":1.5060454143320554,"src":"/blog/static/bc8fa298d34e80cdc77b763be00c957c/1511b/user_info_jwt.jpg","srcSet":"/blog/static/bc8fa298d34e80cdc77b763be00c957c/79e64/user_info_jwt.jpg 269w,\n/blog/static/bc8fa298d34e80cdc77b763be00c957c/b1729/user_info_jwt.jpg 538w,\n/blog/static/bc8fa298d34e80cdc77b763be00c957c/1511b/user_info_jwt.jpg 1075w,\n/blog/static/bc8fa298d34e80cdc77b763be00c957c/57d19/user_info_jwt.jpg 1613w,\n/blog/static/bc8fa298d34e80cdc77b763be00c957c/ede7d/user_info_jwt.jpg 2150w,\n/blog/static/bc8fa298d34e80cdc77b763be00c957c/20d2f/user_info_jwt.jpg 5107w","sizes":"(max-width: 1075px) 100vw, 1075px"}},"publicURL":"/blog/static/user_info_jwt-bc8fa298d34e80cdc77b763be00c957c.jpg"},"meta_title":"Requesting User details from JWT in Django OAuth Toolkit","meta_description":"Learn to write an API to fetch the details of currently logged in user, using the Authorization Token, in Django Oauth Toolkit","tags":["Authorization","OAuth Toolkit","API","Django","DRF"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"7f8850e1-eb88-50e4-a31a-f1c1dbf7fb9d"}}}